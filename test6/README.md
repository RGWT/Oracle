- 期末考核要求
  - 自行设计一个信息系统的数据库项目，自拟`某项目`名称。
  - 设计项目涉及的表及表空间使用方案。至少5张表和5万条数据，两个表空间。
  - 设计权限及用户分配方案。至少两类角色，两个用户。
  - 在数据库中建立一个程序包，在包中用PL/SQL语言设计一些存储过程和函数，实现比较复杂的业务逻辑，用模拟数据进行执行计划分析。
  - 设计自动备份方案或则手工备份方案。
  - 设计容灾方案。使用两台主机，通过DataGuard实现数据库整体的异地备份(可选)。

## 实验注意事项，完成时间： 2021-6-15日前上交

- 实验在自己的计算机上完成。

- 文档

  ```
  必须提交
  ```

  到你的Oracle项目中的test6目录中。文档必须上传两套，因此你的test6目录中必须至少有两个文件：

  - 一个是Markdown格式的，文件名称是test6.md。
  - 另一个是Word格式的，文件名称是test6_design.docx。参见[test6_design.docx](https://github.com/Windgwh/oracle/blob/main/test6/test6_design.docx)，文件不用打印。

- 上交后，通过这个地址应该可以打开你的源码：https://github.com/你的用户名/oracle/tree/master/test6

- 文档中所有设计和数据都必须是你自己独立完成的真实实验结果。不得抄袭，杜撰。

## 评分标准

| 评分项     | 评分标准                     | 满分 |
| ---------- | ---------------------------- | ---- |
| 文档整体   | 文档内容详实、规范，美观大方 | 10   |
| 表设计     | 表，表空间设计合理，数据合理 | 20   |
| 用户管理   | 权限及用户分配方案设计正确   | 20   |
| PL/SQL设计 | 存储过程和函数设计正确       | 30   |
| 备份方案   | 备份方案设计正确             | 20   |



## 1.创建表空间

- space_wtoo1（图1-1）



- space_wtoo2（图1-2）



- 结果图（1-3）





## 2.创建角色及用户

#### 用户默认使用表空间space_wt001

#### 创建第一个角色和用户

- 创建角色wt1将connect,resource,create view授权给wt1
- 创建用户wt_1
- 分配60M空间给wt_1并将角色qhl1授权给用户wt_1

（图2-1）



结果图（2-2）



#### 创建第2个角色和用户

- 创建角色wt2将connect,resource,create view授权给wt2
- 创建用户wt_2
- 分配60M空间给wt_2并将角色qhl1授权给用户wt_2

（图2-3）



结果图（2-4）





#### 3. 在用户wt_1下创建表

**创建管理员表**

- id为主键（图3-1）



**创建用户表**

- id为主键
- 根据注册日期按范围分区
- 分为2018和2019年两个分区，每年按季度划4个子分区（图3-2）



**创建商品表**（图3-3）



**创建购物车表**

- 用户表字段BOOKUSER_ID为购物车表的外键
- 购物车采用引用分区（图3-4）



**创建完成后表结构如下**（图3-5）



#### 4. 插入用户、商品、购物车数据

（图4-1）



#### 5.创建程序包、存储过程、函数执行分析计划

**创建程序包**

- 函数getcartsumprice计算每个用户的购物车商品总金额
- 存储过程adduser插入用户信息（图5-1）



**存储过程、函数执行分析**

使用自定义函数getcartsumprice（）查询id号为20011的用户购物车商品总价（图5-2）



结果图（图5-3）



##### 使用存储过程adduser插入用户数据（图5-4）



结果图（图5-5）



结果图（图5-6）



**执行计划分析**（图5-7）



结果图（图5-8）



**表空间使用状况**（图5-9）



#### 6.备份恢复

- 备份./rman_level0.sh（图6-1）



- 删除数据（图6-2）



- 恢复备份（图6-3）



- 数据已恢复（图6-4）